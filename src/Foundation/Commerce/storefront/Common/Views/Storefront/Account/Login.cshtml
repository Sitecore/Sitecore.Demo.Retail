@*//-----------------------------------------------------------------------
  // Copyright 2016 Sitecore Corporation A/S
  // Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file
  // except in compliance with the License. You may obtain a copy of the License at
  //       http://www.apache.org/licenses/LICENSE-2.0
  //
  // Unless required by applicable law or agreed to in writing, software distributed under the
  // License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND,
  // either express or implied. See the License for the specific language governing permissions
  // and limitations under the License.
  // -------------------------------------------------------------------------------------------*@
@using Sitecore.Collections
@using Sitecore.Foundation.Commerce
@using Sitecore.Foundation.SitecoreExtensions.Extensions
@using Sitecore.Mvc.Configuration
@using Sitecore.Foundation.Commerce.Managers
@model LoginModel
@{
    var signing = Html.Sitecore().CurrentItem[StorefrontConstants.KnownFieldNames.SigningButton];
    var storefront = StorefrontManager.CurrentStorefront;
}

@using (Html.BeginRouteForm(MvcSettings.SitecoreRouteName, new
                                                           {
                                                               ViewBag.ReturnUrl
                                                           }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    @Html.Sitecore().FormHandler()

    <!-- CONTENT CONTAINER -->
    if (storefront.FormsAuthentication)
    {
        <div class="form-group">
            <label for="UserName">@Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.Email, Html.Sitecore().CurrentItem)</label><span class="required">*</span>
            @Html.TextBoxFor(m => m.UserName, new
                                                {
                                                    placeholder = Html.Sitecore().CurrentItem[StorefrontConstants.KnownFieldNames.EmailAddressPlaceholder],
                                                    data_val_required = Html.Sitecore().CurrentItem[StorefrontConstants.KnownFieldNames.EmailMissingMessage],
                                                    @class = "form-control"
                                                })
            @Html.ValidationMessageFor(m => m.UserName)
        </div>
        <div class="form-group">
            <label for="Password">@Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.Password, Html.Sitecore().CurrentItem)</label><span class="required">*</span>
            @Html.PasswordFor(m => m.Password, new
                                                {
                                                    placeholder = Html.Sitecore().CurrentItem[StorefrontConstants.KnownFieldNames.PasswordPlaceholder],
                                                    data_val_required = Html.Sitecore().CurrentItem[StorefrontConstants.KnownFieldNames.PasswordMissingMessage],
                                                    @class = "form-control",
                                                    autocomplete = "off"
                                                })

            @Html.ValidationMessageFor(m => m.Password)
        </div>
        <button type="submit" id="SignInButton" data-loading-text="@signing" class="btn btn-primary btn-lg btn-block">@Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.SignInButton, Html.Sitecore().CurrentItem)</button>

        <div class="m-b-1">
            <a class="btn btn-link" href="@StorefrontManager.StorefrontUri("/forgotpassword")">@Html.Sitecore().Field("Forgot Password", Html.Sitecore().CurrentItem)</a>
        </div>

        <div class="row">
            <div class="col-lg-6 m-b-1">
                <button type="button" id="GetToRegisterButton" onclick="window.location.href = '@StorefrontManager.StorefrontUri("/Register")'" class="btn btn-default btn-lg btn-block">@Html.Sitecore().Field("Register New Account", Html.Sitecore().CurrentItem)</button>
            </div>
            <div class="col-lg-6">
                <button type="button" class="btn btn-default btn-lg btn-block" onclick="window.location.href='@StorefrontManager.StorefrontUri("/Checkout")'">
                    @Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.GuestCheckoutButton, Html.Sitecore().CurrentItem)
                </button>
            </div>
        </div>
    }
    if (Model != null && Model.Providers != null && Model.Providers.Count > 0)
    {
        <div class="row">
            @Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.FacebookText, Html.Sitecore().CurrentItem)
            @foreach (var provider in Model.Providers)
            {
                <div class="col-lg-4">
                    <button name="provider" type="submit" onclick="window.location.href = '#'" class="btn btn-primary btn-block btn-social-@provider.Name" id="@provider.Name" value="@provider.Name" style='background-image: url("@(provider.Image?.ImageUrl(28, 28))"); background-repeat: no-repeat'>
                        <div id="provider-name">&emsp;&nbsp;@provider.Name&nbsp;@Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.SignInButton, Html.Sitecore().CurrentItem)</div>
                    </button>
                </div>
            }

            @if (!Model.IsActivationFlow)
            {
                <div class="col-lg-4">
                    @Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.LinkAccount, Html.Sitecore().CurrentItem)
                    <a class="btn btn-default btn-block" href="@StorefrontManager.StorefrontUri("/UserPendingActivation")">
                        @Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.ActivationText, Html.Sitecore().CurrentItem)
                    </a>
                </div>
            }

            <div class="col-lg-4">
                <button type="button" class="btn btn-default btn-block" onclick="window.location.href = '@StorefrontManager.StorefrontUri("/Checkout")'">
                    @Html.Sitecore().Field(StorefrontConstants.KnownFieldNames.GuestCheckoutButton, Html.Sitecore().CurrentItem)
                </button>
            </div>
        </div>
    }
}

<script type="text/javascript">
    $(document)
        .on('submit',
            'form',
            function() {
                $("#SignInButton").button('loading');
            });
</script>
